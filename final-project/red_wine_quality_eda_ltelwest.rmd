Exploring Red Wine Quality by Lennart Telwest
========================================================
![](red-wine-unsplash.jpg)
```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all the packages for this analysis
library(ggplot2)
library(dplyr)
library(GGally)
library(scales)
library(memisc)
library(reshape)
library(gridExtra)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
# Load the Data
df <- read.csv("~/git/R-EDA/final-project/wineQualityReds.csv")
```

# Introduction

## About the dataset
This analysis will explore a dataset on wine quality and physicochemical
properties. The objective is to explore which chemical properties influence the
quality of red wines.

The dataset contains red variants of the Portuguese "Vinho Verde" wine. Only 
physicochemical (inputs) and sensory (the output) variables are available.

## Description of attributes:

1. fixed acidity: most acids involved with wine or fixed or nonvolatile (do not 
evaporate readily)

2. volatile acidity: the amount of acetic acid in wine, which at too high of 
levels can lead to an unpleasant, vinegar taste

3. citric acid: found in small quantities, citric acid can add 'freshness' and 
flavor to wines

4. residual sugar: the amount of sugar remaining after fermentation stops, it's
rare to find wines with less than 1 gram/liter and wines with greater than 45 
grams/liter are considered sweet

5. chlorides: the amount of salt in the wine

6. free sulfur dioxide: the free form of SO2 exists in equilibrium between 
molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial 
growth and the oxidation of wine

7. total sulfur dioxide: amount of free and bound forms of S02; in low 
concentrations, SO2 is mostly undetectable in wine, but at free SO2 
concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine

8. density: the density of water is close to that of water depending on the 
percent alcohol and sugar content

9. pH: describes how acidic or basic a wine is on a scale from 0 (very acidic) 
to 14 (very basic); most wines are between 3-4 on the pH scale

10. sulphates: a wine additive which can contribute to sulfur dioxide gas (S02) 
levels, wich acts as an antimicrobial and antioxidant

11. alcohol: the percent alcohol content of the wine

12. quality (score between 0 and 10)

This desription and more background information can be found 
[here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt).

This analysis is based on:
   P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.
   Modeling wine preferences by data mining from physicochemical properties.
   In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.
The dataset is available 
[here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityReds.csv)

## Summary of the dataset
Let's get a first glimpse on the available variables and their distribution
by plotting the Five-number summary extended by the mean.

```{r echo=TRUE, message=FALSE, warning=FALSE, Summary_of_dataset}
str(df)
summary(df)
```



# Univariate Plots Section

## Fixed Acidity
Defintion: most acids involved with wine or fixed or nonvolatile (do not 
evaporate readily).
The fixed acidity is a right-skewed distribution, with a median of 7.9 g tartaric
acid per liter.

```{r echo=FALSE, message=FALSE, warning=FALSE, fixed_acidity_plot}
qplot(df$fixed.acidity)+ 
  ggtitle('Fixed Acidity') +
  xlab('tartaric acid - g / dm^3') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, fixed_acidity_summary}
summary(df$fixed.acidity)
```

## Volatile Acidity
Definition: the amount of acetic acid in wine, which at too high of  levels can
lead to an unpleasant, vinegar taste.
The volatile acidity is almost a symmetric distribution with a few positive 
outliers. The median and mean are ~5.2 g acetic acid per liter.

```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_acidity_plot}
qplot(df$volatile.acidity)+ 
  ggtitle('Volatile Acidity') +
  xlab('acetic acid - g / dm^3') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_acidity_summary}
summary(df$volatile.acidity)
```

## Citric Acid
Definition: found in small quantities, citric acid can add 'freshness' and 
flavor to wines.
The citric acidity is a linear decreasing distribution with median of ~0.26 g 
citric acid per liter. Most of the wines (>150) do not contain any citric acid.
This distribution should be investigated for correlations later on!
```{r echo=FALSE, message=FALSE, warning=FALSE, citric_acid_plot}
qplot(df$citric.acid)+ 
  ggtitle('Citric Acid') +
  xlab('g / dm^3') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, citric_acid_summary}
summary(df$citric.acid)
```

## Residual Sugar
Definition: the amount of sugar remaining after fermentation stops, it'srare to 
find wines with less than 1 gram/liter and wines with greater than 45 grams/liter
are considered sweet.
Most of the red wines in the dataset contain between 1.9 and 2.5 grams sugar per
liter, while there is a long tail with wines that contain up to a maximum of 15 
grams sugar per liter.

```{r echo=FALSE, message=FALSE, warning=FALSE, residual_sugar_plot}
qplot(df$residual.sugar)+ 
  ggtitle('Residual Sugar') +
  xlab('g / dm^3') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, residual_sugar_summary}
summary(df$residual.sugar)
```

## Chlorides
Definition: the amount of salt in the wine.
Most wines contain between 0.07 and 0.09 g of salt per liter. Again there is a 
long tail with wines containing up to 0.6 g of salt per liter.

```{r echo=FALSE, message=FALSE, warning=FALSE, chlorides_plot}
qplot(df$chlorides)+ 
  ggtitle('Chlorides') +
  xlab('sodium chloride - g / dm^3') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, chlorides_summary}
summary(df$chlorides)
```


## Free Sulfur Dioxide
Definition: the free form of SO2 exists in equilibrium between molecular SO2 
(as a dissolved gas) and bisulfite ion; it prevents microbial growth and the 
oxidation of wine.
In the dataset the free sulfur dioxid is found in a right-skewed distribution, 
with an average of 16g per liter and 50% of the wines containing 7-21g per liter.

```{r echo=FALSE, message=FALSE, warning=FALSE, free_sulfur_dioxide_plot}
qplot(df$free.sulfur.dioxide)+ 
  ggtitle('Free Sulfur Dioxide') +
  xlab('mg / dm^3') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, free_sulfur_dioxide_summary}
summary(df$free.sulfur.dioxide)
```

## Total sulfur dioxide
Definition: amount of free and bound forms of S02; in low concentrations, SO2 is
mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 
becomes evident in the nose and taste of wine.

The red wines contain at least 6 mg per liter and most wines (75%) contain no 
more than 62mg/l. The distribution is decreasing, with some very extreme outliers
with more than 250mg/l.

```{r echo=FALSE, message=FALSE, warning=FALSE, total_sulfur_dioxide_plot}
qplot(df$total.sulfur.dioxide)+ 
  ggtitle('Total sulfur dioxide') +
  xlab('mg / dm^3') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, total_sulfur_dioxide_summary}
summary(df$total.sulfur.dioxide)
```

## Density
Definition: the density of water is close to that of water depending on the 
percent alcohol and sugar content.

The density is normally distributed, with an average and mean ~1g/l.

```{r echo=FALSE, message=FALSE, warning=FALSE, density_plot}
qplot(df$density)+ 
  ggtitle('Density') +
  xlab('g / cm^3') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, density_summary}
summary(df$density)
```

## pH Value
Definition: describes how acidic or basic a wine is on a scale from 0 (very 
acidic) to 14 (very basic); most wines are between 3-4 on the pH scale.

The pH value is normally distributed, with a few positive and negative outliers.

```{r echo=FALSE, message=FALSE, warning=FALSE, pH_plot}
qplot(df$pH)+ 
  ggtitle('pH Value') +
  xlab('pH') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, pH_summary}
summary(df$pH)
```

## Sulphates
Definition: a wine additive which can contribute to sulfur dioxide gas (S02) 
levels, wich acts as an antimicrobial and antioxidant.

Sulphates is a right skewed distribution. Most wines contain between 0.3 and 0.7
g/l - with some outliers ranging up to 2g/l.

```{r echo=FALSE, message=FALSE, warning=FALSE, sulphates_plot}
qplot(df$sulphates)+ 
  ggtitle('Sulphates') +
  xlab('potassium sulphate - g / dm3') +
  ylab('Number of Wines')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, sulphates_summary}
summary(df$sulphates)
```

## Alcohol
Definition: the percent alcohol content of the wine

Most wines contain between ~10% of alcohol. The distribution is skewed with more
wines containing more than 10% then lower percentage of alcohol.


```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_plot}
qplot(df$alcohol)+ 
  ggtitle('Alcohol') +
  xlab('% by volume') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_summary}
summary(df$alcohol)
```

## Quality
Defintion: quality is the median of a score between 0 and 10 given by wine experts.

The experts moslty gave a rating of 5 or 6. Even though there are a more wines 
with a rating of 6 and higher than 5 and less the plot looks normally distributed.


```{r echo=FALSE, message=FALSE, warning=FALSE, quality_plot}
qplot(df$quality)+ 
  ggtitle('Quality') +
  xlab('score') +
  ylab('Number of Wines')
```
```{r echo=FALSE, message=FALSE, warning=FALSE, quality_summary}
summary(df$quality)
```

As seen in the frequency diagramm above, the amount of wines that recieved a 
ranking <5 or >6 is negligible so I'll bin them into the categories bad, OK, good
and very good to get rid of the very few 3 & 8 ratings.

```{r echo=FALSE, message=FALSE, warning=FALSE, compute_rating}
df$rating <- ifelse(df$quality < 5, 'bad', ifelse(
  df$quality == 5, 'OK', ifelse(df$quality == 6, 'good', 'very good')))
df$rating <- ordered(df$rating,
                     levels = c('bad', 'OK', 'good', 'very good'))
summary(df$rating)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, rating_plot}
qplot(df$rating)+ 
  ggtitle('Rating') +
  xlab('rating') +
  ylab('Number of Wines')
```


# Univariate Analysis

### What is the structure of your dataset?

There are 1599 observations of 13 numeric variables, with X being the ID it total
there are 11 input variables and 1 output variable.
The output variable `quality` is categorical, based on the median of at least 
3 evaluations made by wine experts. Each expert graded the wine quality between 
0 (very bad) and 10 (very excellent). As seen in the summary above, the output 
(median) `quality` of those ratings ranged only from 3 to 8, with a mean of 5.6 
and median of 6.
The main feature of interest is the quality which is what in the end matters when
buying and drinking wine.
The most interesting variables are those that are not normal distributed:
Citric Acid, Total sulfur dioxide and Alcohol.
One new variable has been introducded: the rating. As the distrubution of the 
quality is mostly containing 5's and 6's and scatter below and above, the rating 
acts as a summary metric. By matching the quality in the 4 rating categories 
bad, OK, good & very good it can be used in further plots to reduce scatter 
without loosing too much detail.


# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, boxplots}
get_bivariate_boxplot <- function(x, y, ylab) {
  return(qplot(data = df, x = x, y = y, geom = 'boxplot', ylab = ylab))
}

grid.arrange(get_bivariate_boxplot(df$quality, df$fixed.acidity,
                                   'fixed acidity'),
             get_bivariate_boxplot(df$quality, df$volatile.acidity,
                                   'volatile acidity'),
             get_bivariate_boxplot(df$quality, df$citric.acid,
                                   'citric acid'),
             get_bivariate_boxplot(df$quality, df$TAC.acidity,
                                   'TAC acidity'),
             get_bivariate_boxplot(df$quality, log10(df$residual.sugar),
                                   'residual sugar'),
             get_bivariate_boxplot(df$quality, log10(df$chlorides),
                                   'chlorides'),
             get_bivariate_boxplot(df$quality, df$free.sulfur.dioxide,
                                   'free sulf. dioxide'),
             get_bivariate_boxplot(df$quality, df$total.sulfur.dioxide,
                                   'total sulf. dioxide'),
             get_bivariate_boxplot(df$quality, df$density,
                                   'density'),
             get_bivariate_boxplot(df$quality, df$pH,
                                   'pH'),
             get_bivariate_boxplot(df$quality, log10(df$sulphates),
                                   'sulphates'),
             get_bivariate_boxplot(df$quality, df$alcohol,
                                   'alcohol'),
             ncol = 4)

grid.arrange(get_bivariate_boxplot(df$rating, df$fixed.acidity,
                                   'fixed acidity'),
             get_bivariate_boxplot(df$rating, df$volatile.acidity,
                                   'volatile acidity'),
             get_bivariate_boxplot(df$rating, df$citric.acid,
                                   'citric acid'),
             get_bivariate_boxplot(df$rating, df$TAC.acidity,
                                   'TAC acidity'),
             get_bivariate_boxplot(df$rating, log10(df$residual.sugar),
                                   'residual sugar'),
             get_bivariate_boxplot(df$rating, log10(df$chlorides),
                                   'chlorides'),
             get_bivariate_boxplot(df$rating, df$free.sulfur.dioxide,
                                   'free sulf. dioxide'),
             get_bivariate_boxplot(df$rating, df$total.sulfur.dioxide,
                                   'total sulf. dioxide'),
             get_bivariate_boxplot(df$rating, df$density,
                                   'density'),
             get_bivariate_boxplot(df$rating, df$pH,
                                   'pH'),
             get_bivariate_boxplot(df$rating, log10(df$sulphates),
                                   'sulphates'),
             get_bivariate_boxplot(df$rating, df$alcohol,
                                   'alcohol'),
             ncol = 4)
```

The boxplots already hint towards some correlations:

Wines of higher quality have:

- high fixed acidity
- low volatile acitidy
- high citric acid
- low density
- low pH-value
- high sulphates
- high alcohol

The other variables do not seem to have an impact on the quality of the wine.

Futher investigation of correlation of the variables against quality should be 
done using `cor.test`:

```{r echo=FALSE, message=FALSE, warning=FALSE, calculate_correlation}
simple_cor_test <- function(x, y) {
  return(cor.test(x, as.numeric(y), method=("pearson"))$estimate)
}

correlations <- c(
  simple_cor_test(df$fixed.acidity, df$quality),
  simple_cor_test(df$volatile.acidity, df$quality),
  simple_cor_test(df$citric.acid, df$quality),
  simple_cor_test(df$density, df$quality),
  simple_cor_test(df$pH, df$quality),
  simple_cor_test(log10(df$sulphates), df$quality),
  simple_cor_test(df$alcohol, df$quality))
names(correlations) <- c('fixed.acidity', 'volatile.acidity', 'citric.acid',
                         'density', 'pH', 'log10.sulphates', 'alcohol')
correlations
```

The following variables have correlations to wine quality:

- alcohol
- volatile acidity
- sulphates
- citric acid
- density
- fixed acidity

The pH-value does not correlate with wine quality.

Let's see how these variables compare, plotted against each other and faceted by wine `rating`:

```{r echo=FALSE, message=FALSE, warning=FALSE, variable_correlation_scatterplot}
ggplot(data = df, aes(x = volatile.acidity, y = alcohol)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = log10(sulphates), y = alcohol)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = citric.acid, y = alcohol)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = density, y = alcohol)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = fixed.acidity, y = alcohol)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = volatile.acidity, y = log10(sulphates))) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = citric.acid, y = log10(sulphates))) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = density, y = log10(sulphates))) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = fixed.acidity, y = log10(sulphates))) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = citric.acid, y = volatile.acidity)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = density, y = volatile.acidity)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = fixed.acidity, y = volatile.acidity)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = density, y = citric.acid)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = fixed.acidity, y = citric.acid)) +
  facet_wrap(~rating) +
  geom_point()

ggplot(data = df, aes(x = fixed.acidity, y = density)) +
  facet_wrap(~rating) +
  geom_point()
```

Most of the plots are nearly uniformly-distributed, but some observations could
be made and will be explained in the analysis part.

# Bivariate Analysis

The strongest correlation is between alcohol & quality which can be clearly seen
in the boxplot with an ascending quality with increasing alcohol level.
Also, following variables correlate with wine quality (in descending order):

- alcohol
- volatile acidity
- sulphates
- citric acid
- density
- fixed acidity

There are two main observations when investigating the correlation between those
variables:

1. Alcohol and density correlate negatively: the higher the alcohol the lower the
density. This can easily be explained with the lower density of alcohol compared
to water and if there is relatively more alcohol contained the density is thereby
lower.

2. Fixed acidity and density correlate positively: the higher the fixed acidity
the higher the density. This was suprising at first, as acidity does not 
correlate with the alcohol amount, which itself is correlating with the density.
After doing a little research it seems the acidity has a chemical effect on the 
density, thus the correlation

# Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots}
ggplot(data = df,
       aes(x = fixed.acidity, y = density,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = df,
       aes(x = alcohol, y = density,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = df,
       aes(x = alcohol, y = fixed.acidity,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = df,
       aes(x = alcohol, y = volatile.acidity,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = df,
       aes(x = alcohol, y = sulphates,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)

ggplot(data = df,
       aes(x = alcohol, y = citric.acid,
           color = quality)) +
  geom_point() +
  facet_wrap(~rating)
```

# Multivariate Analysis

The scatterplots examine the 6 variables we had identified correlating with the
quality of wines. To reduce the clutter, they are faceted by rating.
The volatile acidity appears to be rather low for a wine of good quality,no 
matter the amount of alcohol contained. Also the sulphate level & alcohol plot
show a picture of wines of good quality beeing concetrated in a smaller area 
around 11.8% alcohol and sulfate levels around 0.75.
When looking at the citric acid there is a very interesting gap of good wines at
0.25. Some of the wines that contain less were given a good quality rating by the
judges as well as mostly those above. All the wines that contain between 0.19 and
0.25 of citric acid are considered average or bad.


------

## Final Plots and Summary

### Plot 1: Effect of acids on wine quality
```{r echo=FALSE, message=FALSE, warning=FALSE, acids_quality_boxplot}
grid.arrange(ggplot(data = df, aes(x = quality, y = fixed.acidity,
                                   fill = quality)) + 
               ylab('Fixed Acidity (g/dm^3)') +
               xlab('Quality') +
               geom_boxplot(),
             ggplot(data = df, aes(x = quality, y = volatile.acidity,
                                   fill = quality)) +
               ylab('Volatile Acidity (g/dm^3)') +
               xlab('Quality') +
               geom_boxplot(), 
             ggplot(data = df, aes(x = quality, y = citric.acid,
                                   fill = quality)) +
               ylab('Citric Acid (g/dm^3)') +
               xlab('Quality') +
               geom_boxplot(), 
             ggplot(data = df, aes(x = quality, y = pH,
                                   fill = quality)) +
               ylab('pH') +
               xlab('Quality') +
               geom_boxplot())

```

### Effect of acids on wine quality
The boxplots show a very clear trend for citric acid as well as volatile acidity
on the qualtiy of red wine. Lower volatile acidity and higher citric acidity lead
to better wine quality. Those two forms of acid seem to cancel each other out,
as they're both influencing the fixed acidity and the pH value of the wine which
does not show a clear trend which could be linked to wine quality.

### Plot 2: Effect of Alcohol on Wine Quality
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_quality}
ggplot(data = df, aes(x = quality, y = alcohol,
                      fill = rating)) +
  geom_boxplot() +
  ggtitle('Alcohol Levels in Different Wine Qualities') +
  xlab('Quality') +
  ylab('Alcohol (% volume)')
```

### The effect of Alcohol on Wine Quality

These boxplots clearly show the effect of alcohol content on the quality of a 
wine. Even though there are outliers in the group of wines rated 'OK', in general
a higher amount of alcohol is an indicator for a wine of good quality.

### Plot 3: What makes good wines, good, and bad wines, bad?
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}
ggplot(data = subset(subset(df, rating != 'OK'), rating != 'good'),
       aes(x = volatile.acidity, y = alcohol,
                      color = rating)) +
  geom_point() +
  ggtitle('Alcohol vs. Volatile Acidity and Wine Quality') +
  xlab('Volatile Acidity (g / dm^3)') +
  ylab('Alcohol (% volume)')
```

### Description Three
In this graph only the very good and bad wines had been considered after seeing 
the same trend not that clearly when considering wines with all types of rating.
This summarizes the strongest findings that were made:
For a wine to be of good quality, dependens on a low volatile acidity and a high
amount of alcohol contained.

------

# Reflection

Through this exploratory data analysis, I was able to identify the key factors that determine and drive wine quality, mainly: alcohol content, sulphates, and acidity.  It is important to note, however, that wine quality is ultimately a subjective measure, albeit measured by wine experts.  That said, the correlations for these variables are within reasonable bounds.  The graphs adequately illustrate the factors that make good wines 'good' and bad wines 'bad'.  Further study with inferential statistics could be done to quantitatively confirm these assertions.